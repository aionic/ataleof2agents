# Dockerfile for Azure Functions deployment
# Based on Microsoft's official Azure Functions Python image

FROM mcr.microsoft.com/azure-functions/python:4-python3.11

# Set environment variables
ENV AzureWebJobsScriptRoot=/home/site/wwwroot \
    AzureFunctionsJobHost__Logging__Console__IsEnabled=true

# Install uv for faster dependency resolution
COPY --from=ghcr.io/astral-sh/uv:latest /uv /usr/local/bin/uv

# Copy function code
COPY src/function/ /home/site/wwwroot/
COPY src/shared/ /home/site/wwwroot/shared/

# Install Python dependencies
WORKDIR /home/site/wwwroot
RUN if [ -f requirements.txt ]; then \
        uv pip install --system --no-cache -r requirements.txt; \
    fi

# Azure Functions will automatically run the function app
